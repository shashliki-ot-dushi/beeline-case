<img src="https://static.beeline.ru/upload/dpcupload/contents/342/avatarbee_2704.svg" align="right" width="130"/>

# Code Insight

–ò–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞ –∫–æ–¥–∞ –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã, –≤—ã—è–≤–ª–µ–Ω–∏—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –ø–æ–¥—Ä–æ–±–Ω–æ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏. –ü—Ä–æ–µ–∫—Ç –ø–æ–º–æ–≥–∞–µ—Ç –∏–Ω–∂–µ–Ω–µ—Ä–∞–º –±—ã—Å—Ç—Ä–æ –ø–æ–Ω—è—Ç—å —Å–ª–æ–∂–Ω—ã–µ –∫–æ–¥–æ–≤—ã–µ –±–∞–∑—ã –∏ —Å–Ω–∏–∑–∏—Ç—å —Ä–∏—Å–∫–∏ –ø—Ä–∏ –º–∏–≥—Ä–∞—Ü–∏–∏ –∏ –º–æ–¥–µ—Ä–Ω–∏–∑–∞—Ü–∏–∏ —Å–∏—Å—Ç–µ–º.

## üéØ –û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

* **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑**

  * –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ Git-—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–≤ –∏ –æ–±—Ö–æ–¥ –∏—Å—Ö–æ–¥–Ω–∏–∫–æ–≤
  * –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –≥—Ä–∞—Ñ–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π (–º–æ–¥—É–ª–∏, –∫–ª–∞—Å—Å—ã, —Ñ—É–Ω–∫—Ü–∏–∏, –∏–º–ø–æ—Ä—Ç, –≤—ã–∑–æ–≤—ã)
* **–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã—Ö –¥–∏–∞–≥—Ä–∞–º–º (C4/Mermaid)**
  –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –≥—Ä–∞—Ñ–∞ –≤ —Å—Ç—Ä—É–∫—Ç—É—Ä—É C4 –∏ –≤ —É–¥–æ–±–æ—á–∏—Ç–∞–µ–º—ã–π —Å–∏–Ω—Ç–∞–∫—Å–∏—Å Mermaid
* **RAG-–ø–æ–∏—Å–∫ –ø–æ –∫–æ–¥—É**
  –ò–Ω–¥–µ–∫—Å–∞—Ü–∏—è —Ñ—Ä–∞–≥–º–µ–Ω—Ç–æ–≤ –∫–æ–¥–∞ –≤ MinIO + Qdrant, –ø–æ–∏—Å–∫ –ø–æ —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–º –∑–∞–ø—Ä–æ—Å–∞–º
* **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å LLM (Yandex GPT)**
  –°—É–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –æ–±–æ–±—â–µ–Ω–∏–µ –∫–æ–¥–∞ –Ω–∞ —É—Ä–æ–≤–Ω–µ –±–ª–æ–∫–æ–≤, —Ñ–∞–π–ª–æ–≤ –∏ –≤—Å–µ–≥–æ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
* **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ –∏ –ø—Ä–æ–µ–∫—Ç–∞–º–∏** —á–µ—Ä–µ–∑ REST API

## üõ†Ô∏è –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –∑–∞–ø—É—Å–∫

### –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

* Python ‚â• 3.12
* PostgreSQL
* MinIO (–∏–ª–∏ –ª—é–±–æ–µ S3-—Å–æ–≤–º–µ—Å—Ç–∏–º–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ)
* Qdrant
* Docker & Docker Compose (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
* API-–∫–ª—é—á Yandex Cloud –¥–ª—è GPT

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è

1. **.env –¥–ª—è llm\_analysis/**
   –í `llm_analysis/.env` –¥–æ–±–∞–≤—å—Ç–µ:

   ```dotenv
   YANDEX_API_KEY=<–≤–∞—à API-–∫–ª—é—á>
   YANDEX_MODEL_ID=gpt-3.5-large
   ```
2. **–û—Å–Ω–æ–≤–Ω–æ–π .env**
   –í –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞ –∏–ª–∏ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–π—Ç–µ:

   ```dotenv
   DATABASE_URL=postgresql://user:pass@host:5432/db
   AWS_ENDPOINT_URL=http://minio:9000
   AWS_ACCESS_KEY_ID=<–∫–ª—é—á>
   AWS_SECRET_ACCESS_KEY=<—Å–µ–∫—Ä–µ—Ç>
   AWS_S3_BUCKET=<–∏–º—è –±–∞–∫–µ—Ç–∞>
   QDRANT_URL=<http://qdrant-host:6333>
   ```

### –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–∏—Å–æ–≤

*(–ø—Ä–∏–º–µ—Ä —Å Docker Compose ‚Äî —Å–æ–∑–¥–∞–π—Ç–µ —Å–≤–æ–π `docker-compose.yml` –∏–ª–∏ –∑–∞–ø—É—Å–∫–∞–π—Ç–µ –≤—Ä—É—á–Ω—É—é)*

```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã –≤ —Ñ–æ–Ω–µ
docker-compose up -d
```

–ò–ª–∏ –≤—Ä—É—á–Ω—É—é:

```bash
# User Service
cd user_service
pip install -r requirements.txt
uvicorn main:app --host 0.0.0.0 --port 8000

# RAG Service
cd ../rag
pip install -r requirements.txt
uvicorn rag_service:app --host 0.0.0.0 --port 8001

# LLM Analysis Service
cd ../llm_analysis
pip install -r requirements.txt
uvicorn app.main:app --host 0.0.0.0 --port 8002
```

–ü—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ **—Å–æ–∑–¥–∞–π—Ç–µ —Ç–∞–±–ª–∏—Ü—ã** –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö:

```bash
python - << 'EOF'
from common.database.base import Base, engine
Base.metadata.create_all(bind=engine)
EOF
```

## üí° –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### 1. –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è

–ü–æ–ª—É—á–∏—Ç–µ —Ç–æ–∫–µ–Ω —Å–µ—Å—Å–∏–∏:

```bash
curl -X POST http://localhost:8000/sessions
```

–û—Ç–≤–µ—Ç:

```json
{"session_token":"<UUID4_TOKEN>"}
```

–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∑–∞–≥–æ–ª–æ–≤–æ–∫:

```
Authorization: Bearer <UUID4_TOKEN>
```

### 2. –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞–º–∏

* **–°–æ–∑–¥–∞—Ç—å –ø—Ä–æ–µ–∫—Ç** (Git-—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π):

  ```bash
  curl -X POST http://localhost:8000/projects \
    -H "Authorization: Bearer <TOKEN>" \
    -H "Content-Type: application/json" \
    -d '{"repo_url":"https://github.com/..."}'
  ```
* **–°–ø–∏—Å–æ–∫ –ø—Ä–æ–µ–∫—Ç–æ–≤**:

  ```bash
  curl http://localhost:8000/projects \
    -H "Authorization: Bearer <TOKEN>"
  ```
* **–£–¥–∞–ª–∏—Ç—å –ø—Ä–æ–µ–∫—Ç**:

  ```bash
  curl -X DELETE http://localhost:8000/projects/<project_id> \
    -H "Authorization: Bearer <TOKEN>"
  ```

### 3. –ü–æ–∏—Å–∫ –ø–æ –∫–æ–¥—É (RAG)

```bash
curl -X POST http://localhost:8001/rag-query/<project_id> \
  -H "Authorization: Bearer <TOKEN>" \
  -H "Content-Type: application/json" \
  -d '{"query":"–ö–∞–∫ –≤—ã–∑–≤–∞—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è?"}'
```

### 4. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –¥–∏–∞–≥—Ä–∞–º–º—ã C4

```bash
curl -X POST http://localhost:8002/generate-diagram \
  -H "Content-Type: application/json" \
  -d '{"repo_url":"https://github.com/..."}'
```

–û—Ç–≤–µ—Ç ‚Äî JSON —Å –º–∞—Å—Å–∏–≤–∞–º–∏ `containers`, `components`, `relationships`.
–î–ª—è –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ –≤ Mermaid:

```bash
python to_mermaid.py > diagram.mmd
```

## ü§ù –í–∫–ª–∞–¥

PR –∏ issue –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤—É—é—Ç—Å—è! –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —Å–æ–∑–¥–∞–≤–∞–π—Ç–µ —Ñ–æ—Ä–∫–∏ –∏ –ø—Ä–µ–¥–ª–∞–≥–∞–π—Ç–µ —É–ª—É—á—à–µ–Ω–∏—è.

## üìÑ –õ–∏—Ü–µ–Ω–∑–∏—è

MIT License
